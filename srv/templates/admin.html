<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - 5MP Globe</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #e0e0e0; min-height: 100vh; }
      
      .header { background: rgba(18,18,18,0.95); border-bottom: 1px solid rgba(255,255,255,0.08); padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
      .header h1 { font-size: 20px; font-weight: 600; color: #fff; }
      .back-link { color: #22c55e; text-decoration: none; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 6px; }
      .back-link:hover { color: #16a34a; }
      
      .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
      
      .alert { padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
      .alert-success { background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.3); color: #22c55e; }
      .alert-error { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); color: #ef4444; }
      
      .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px; }
      .stat-card { background: rgba(18,18,18,0.8); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; }
      .stat-label { font-size: 12px; font-weight: 500; color: #888; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
      .stat-value { font-size: 32px; font-weight: 700; color: #fff; }
      .stat-value.accent { color: #22c55e; }
      .stat-value.warning { color: #eab308; }
      
      .section { background: rgba(18,18,18,0.8); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; margin-bottom: 24px; overflow: hidden; }
      .section-header { padding: 16px 20px; border-bottom: 1px solid rgba(255,255,255,0.08); }
      .section-title { font-size: 16px; font-weight: 600; color: #fff; margin-bottom: 4px; }
      .section-subtitle { font-size: 13px; color: #666; }
      .section-content { padding: 0; }
      
      table { width: 100%; border-collapse: collapse; }
      th { padding: 12px 16px; text-align: left; font-size: 11px; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: 0.5px; background: rgba(255,255,255,0.03); }
      td { padding: 14px 16px; font-size: 14px; color: #a0a0a0; border-top: 1px solid rgba(255,255,255,0.05); }
      tr:hover td { background: rgba(255,255,255,0.02); }
      td.name { color: #fff; font-weight: 500; }
      
      .badge { display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 500; }
      .badge-blue { background: rgba(59,130,246,0.15); color: #60a5fa; }
      .badge-green { background: rgba(34,197,94,0.15); color: #22c55e; }
      .badge-purple { background: rgba(168,85,247,0.15); color: #c084fc; }
      
      .btn { padding: 6px 12px; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; border: none; }
      .btn-approve { background: rgba(34,197,94,0.15); color: #22c55e; border: 1px solid rgba(34,197,94,0.3); }
      .btn-approve:hover { background: rgba(34,197,94,0.25); }
      .btn-reject { background: rgba(239,68,68,0.15); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); }
      .btn-reject:hover { background: rgba(239,68,68,0.25); }
      .actions { display: flex; gap: 8px; }
      
      .empty { text-align: center; padding: 40px 20px; color: #555; font-size: 14px; }
      
      .upload-section { padding: 20px; }
      .upload-form { display: flex; flex-direction: column; gap: 12px; }
      .upload-form input[type="file"] { background: rgba(255,255,255,0.05); border: 1px dashed rgba(255,255,255,0.2); border-radius: 8px; padding: 20px; color: #a0a0a0; cursor: pointer; }
      .upload-form input[type="file"]:hover { border-color: rgba(34,197,94,0.5); background: rgba(34,197,94,0.05); }
      .btn-upload { background: rgba(34,197,94,0.15); color: #22c55e; border: 1px solid rgba(34,197,94,0.3); padding: 10px 20px; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
      .btn-upload:hover { background: rgba(34,197,94,0.25); }
      .btn-upload:disabled { opacity: 0.5; cursor: not-allowed; }
      
      .disk-info { display: inline-flex; align-items: center; gap: 6px; background: rgba(59,130,246,0.15); color: #60a5fa; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; }
      .processing-status { background: rgba(234,179,8,0.15); border: 1px solid rgba(234,179,8,0.3); color: #eab308; padding: 10px 16px; border-radius: 6px; font-size: 13px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
      .processing-status::before { content: "‚è≥"; }
      
      .tile-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; padding: 16px; }
      .tile-link { display: block; padding: 8px 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 6px; color: #60a5fa; text-decoration: none; font-size: 12px; font-family: monospace; text-align: center; transition: all 0.2s; }
      .tile-link:hover { background: rgba(59,130,246,0.1); border-color: rgba(59,130,246,0.3); }
      .tile-have { background: rgba(34,197,94,0.1); border-color: rgba(34,197,94,0.3); color: #22c55e; }
      .tile-count { font-size: 12px; color: #666; padding: 0 16px 16px; }
      
      @media (max-width: 768px) {
        .container { padding: 16px; }
        .stats-grid { grid-template-columns: repeat(2, 1fr); }
        table { display: block; overflow-x: auto; }
        .actions { flex-direction: column; }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <h1>Admin Dashboard</h1>
      <a href="/" class="back-link">‚Üê Back to Globe</a>
    </header>

    <div class="container">
      {{if .Success}}
      <div class="alert alert-success">{{.Success}}</div>
      {{end}}
      {{if .Error}}
      <div class="alert alert-error">{{.Error}}</div>
      {{end}}

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Users</div>
          <div class="stat-value">{{.Stats.TotalUsers}}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Pending Approval</div>
          <div class="stat-value warning">{{.Stats.PendingCount}}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Uploads</div>
          <div class="stat-value">{{.Stats.TotalUploads}}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Distance</div>
          <div class="stat-value accent">{{printf "%.1f" .Stats.TotalDistanceKm}} km</div>
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <div class="section-title">Pending Users</div>
          <div class="section-subtitle">Users awaiting approval</div>
        </div>
        <div class="section-content">
          {{if .PendingUsers}}
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Organization</th>
                <th>Type</th>
                <th>Registered</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {{range .PendingUsers}}
              <tr>
                <td class="name">{{.Name}}</td>
                <td>{{.Email}}</td>
                <td>{{.Organization}}</td>
                <td><span class="badge badge-blue">{{.OrganizationType}}</span></td>
                <td>{{.CreatedAt.Format "Jan 02, 2006"}}</td>
                <td>
                  <div class="actions">
                    <form method="POST" action="/admin/approve" style="margin:0;">
                      <input type="hidden" name="user_id" value="{{.ID}}" />
                      <button type="submit" class="btn btn-approve">Approve</button>
                    </form>
                    <form method="POST" action="/admin/reject" style="margin:0;" onsubmit="return confirm('Reject and delete this user?');">
                      <input type="hidden" name="user_id" value="{{.ID}}" />
                      <button type="submit" class="btn btn-reject">Reject</button>
                    </form>
                  </div>
                </td>
              </tr>
              {{end}}
            </tbody>
          </table>
          {{else}}
          <div class="empty">No pending users</div>
          {{end}}
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <div class="section-title">Approved Users</div>
          <div class="section-subtitle">Active users with upload access</div>
        </div>
        <div class="section-content">
          {{if .ApprovedUsers}}
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Organization</th>
                <th>Type</th>
                <th>Role</th>
                <th>Registered</th>
              </tr>
            </thead>
            <tbody>
              {{range .ApprovedUsers}}
              <tr>
                <td class="name">{{.Name}}</td>
                <td>{{.Email}}</td>
                <td>{{.Organization}}</td>
                <td><span class="badge badge-blue">{{.OrganizationType}}</span></td>
                <td>
                  {{if eq .Role "admin"}}
                  <span class="badge badge-purple">Admin</span>
                  {{else}}
                  <span class="badge badge-green">Approved</span>
                  {{end}}
                </td>
                <td>{{.CreatedAt.Format "Jan 02, 2006"}}</td>
              </tr>
              {{end}}
            </tbody>
          </table>
          {{else}}
          <div class="empty">No approved users yet</div>
          {{end}}
        </div>
      </div>

      <!-- Data Upload Section -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">Bulk Data Upload</div>
          <div class="section-subtitle">Upload VIIRS fire data and GHSL tiles <span class="disk-info">üíæ {{.DiskAvailable}} available</span></div>
        </div>
        <div class="section-content">
          {{if .ProcessingStatus}}
          <div class="processing-status">{{.ProcessingStatus}}</div>
          {{end}}
          
          <div class="upload-section">
            <h4 style="color: #fff; margin-bottom: 12px; font-size: 14px;">üî• VIIRS Fire Data Upload</h4>
            <form method="POST" action="/admin/upload/fire" enctype="multipart/form-data" class="upload-form">
              <input type="file" name="fire_csv" accept=".csv" required />
              <div style="display: flex; gap: 12px; align-items: center;">
                <button type="submit" class="btn-upload">Upload Fire CSV</button>
                <span style="font-size: 12px; color: #666;">Accepts VIIRS CSV files from FIRMS</span>
              </div>
            </form>
          </div>
          
          <div style="border-top: 1px solid rgba(255,255,255,0.08); margin: 20px 0;"></div>
          
          <div class="upload-section">
            <h4 style="color: #fff; margin-bottom: 12px; font-size: 14px;">üèóÔ∏è GHSL Tile Upload</h4>
            <form method="POST" action="/admin/upload/ghsl" enctype="multipart/form-data" class="upload-form">
              <input type="file" name="ghsl_zip" accept=".zip" required />
              <div style="display: flex; gap: 12px; align-items: center;">
                <button type="submit" class="btn-upload">Upload GHSL ZIP</button>
                <span style="font-size: 12px; color: #666;">Accepts GHSL tile ZIP files containing TIF</span>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- GHSL Tiles Status -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">GHSL Tiles Status</div>
          <div class="section-subtitle">Required tiles for settlement density analysis</div>
        </div>
        <div class="section-content">
          <div class="tile-count">
            <strong style="color: #22c55e;">{{len .HaveGHSLTiles}}</strong> tiles available, 
            <strong style="color: #eab308;">{{len .NeededGHSLTiles}}</strong> tiles needed
          </div>
          
          {{if .HaveGHSLTiles}}
          <div style="padding: 0 16px 8px;"><small style="color: #666; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px;">Available Tiles</small></div>
          <div class="tile-grid">
            {{range .HaveGHSLTiles}}
            <span class="tile-link tile-have">‚úì {{.}}</span>
            {{end}}
          </div>
          {{end}}
          
          {{if .NeededGHSLTiles}}
          <div style="padding: 16px 16px 8px; border-top: 1px solid rgba(255,255,255,0.05);"><small style="color: #666; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px;">Needed Tiles (click to download)</small></div>
          <div class="tile-grid">
            {{range .NeededGHSLTiles}}
            <a href="{{.URL}}" target="_blank" class="tile-link" title="Download {{.ID}}">{{.ID}}</a>
            {{end}}
          </div>
          {{end}}
        </div>
      </div>
    </div>
  </body>
</html>
